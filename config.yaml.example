# Example configuration for the Salesforce exporter.

s3_info:
  bucket_name: onsen-jasper-importer-prod-data-xxxxx
  access_key_id: 'xxxxxxxx'
  secret_access_key: 'xxxxxxx'
  file_name: 'pms-reservations/あらや滔々庵_'

csv:
  output_directory: data/tmp
  archive_directory: data/archive

salesforce:
  username: your-salesforce-username
  password: your-salesforce-password
  # security_token can be omitted or left blank when IP restrictions make it unnecessary
  security_token: your-salesforce-security-token
  domain: login  # or 'test' for sandbox

# Timezone used for timestamped file names and incremental windows
timezone: Asia/Tokyo

queries:
  - name: ps__Plan__c_all
    soql: |
      SELECT Id, Name
      FROM ps__Plan__c
    incremental: false
    write_output: false

  - name: ps__AccountMaster__c_all
    soql: |
      SELECT Id, Name
      FROM ps__AccountMaster__c
    incremental: false
    write_output: false

  - name: ps__Lead__c_history
    soql: |
      SELECT Id, Name, ps__EntryTime__c, ps__Relcontact__c, ps__Relreserve__c, ps__Rroom__c, ps__Plan__c
      FROM ps__Lead__c
    where: "DAY_ONLY(ps__EntryTime__c) = N_DAYS_AGO:2"
    write_output: false

  - name: Contact_history
    soql: |
      SELECT Id, LastName, FirstName, Email
      FROM Contact
    incremental: false
    relationship_filters:
      - source_query: ps__Lead__c_history
        source_field: ps__Relcontact__c
        target_field: Id
    write_output: false

  - name: ps__Lead__c_onhand
    soql: |
      SELECT Id, Name, ps__EntryTime__c, ps__Relcontact__c, ps__Relreserve__c, ps__Rroom__c, ps__Plan__c
      FROM ps__Lead__c
    where: |
      DAY_ONLY(ps__EntryTime__c) >= N_DAYS_AGO:1
      AND DAY_ONLY(ps__EntryTime__c) <= NEXT_N_DAYS:363
    write_output: false

  - name: Contact_onhand
    soql: |
      SELECT Id, LastName, FirstName, Email
      FROM Contact
    incremental: false
    relationship_filters:
      - source_query: ps__Lead__c_onhand
        source_field: ps__Relcontact__c
        target_field: Id
    write_output: false

  - name: ps_AccountAcount__c_history
    soql: |
      SELECT Id, Name, ps__Relreserve__c, ps__Field1__c, ps__Relmaster__c
      FROM ps_AccountAcount__c
    incremental: false
    relationship_filters:
      - source_query: ps__Lead__c_history
        source_field: Id
        target_field: ps__Relreserve__c
    write_output: false

  - name: ps_AccountAcount__c_onhand
    soql: |
      SELECT Id, Name, ps__Relreserve__c, ps__Field1__c, ps__Relmaster__c
      FROM ps_AccountAcount__c
    incremental: false
    relationship_filters:
      - source_query: ps__Lead__c_onhand
        source_field: Id
        target_field: ps__Relreserve__c
    write_output: false

  - name: ps__Tran1__c_history
    soql: |
      SELECT Id, Name, ps__Field1__c
      FROM ps__Tran1__c
    incremental: false
    relationship_filters:
      - source_query: ps_AccountAcount__c_history
        source_field: Id
        target_field: ps__Field1__c
    write_output: false

  - name: ps__Tran1__c_onhand
    soql: |
      SELECT Id, Name, ps__Field1__c
      FROM ps__Tran1__c
    incremental: false
    relationship_filters:
      - source_query: ps_AccountAcount__c_onhand
        source_field: Id
        target_field: ps__Field1__c
    write_output: false

  - name: ps__Room__c_history
    soql: |
      SELECT Id, Name
      FROM ps__Room__c
    incremental: false
    relationship_filters:
      - source_query: ps__Lead__c_history
        source_field: ps__Rroom__c
        target_field: Id

  - name: ps__Room__c_onhand
    soql: |
      SELECT Id, Name
      FROM ps__Room__c
    incremental: false
    relationship_filters:
      - source_query: ps__Lead__c_onhand
        source_field: ps__Rroom__c
        target_field: Id

  - name: ps__TypeOfRooms__c_all
    soql: |
      SELECT Id, Name
      FROM ps__TypeOfRooms__c
    incremental: false
    output_file: ps__TypeOfRooms__c

combined_outputs:
  - name: Reservations_history
    base_query: ps__Lead__c_history
    output_file: Reservations_history
    joins:
      - source_query: Contact_history
        left_on: ps__Relcontact__c
        right_on: Id
        suffixes: ["", "_Contact"]
      - source_query: ps__Plan__c_all
        left_on: ps__Plan__c
        right_on: Id
        suffixes: ["", "_Plan"]

  - name: Reservations_onhand
    base_query: ps__Lead__c_onhand
    output_file: Reservations_onhand
    joins:
      - source_query: Contact_onhand
        left_on: ps__Relcontact__c
        right_on: Id
        suffixes: ["", "_Contact"]
      - source_query: ps__Plan__c_all
        left_on: ps__Plan__c
        right_on: Id
        suffixes: ["", "_Plan"]

  - name: Sales_history
    base_query: ps__Tran1__c_history
    output_file: Sales_history
    joins:
      - source_query: ps_AccountAcount__c_history
        left_on: ps__Field1__c
        right_on: Id
        suffixes: ["", "_ReservationAccount"]
      - source_query: ps__AccountMaster__c_all
        left_on: ps__Relmaster__c
        right_on: Id
        suffixes: ["", "_AccountMaster"]

  - name: Sales_onhand
    base_query: ps__Tran1__c_onhand
    output_file: Sales_onhand
    joins:
      - source_query: ps_AccountAcount__c_onhand
        left_on: ps__Field1__c
        right_on: Id
        suffixes: ["", "_ReservationAccount"]
      - source_query: ps__AccountMaster__c_all
        left_on: ps__Relmaster__c
        right_on: Id
        suffixes: ["", "_AccountMaster"]
